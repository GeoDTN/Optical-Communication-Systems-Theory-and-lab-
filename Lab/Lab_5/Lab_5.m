%Optical Communication Systems/Components
%Lab 5

clear all;
close all;
clc;

%Exercise 1

P=1e-3; %[W]
Pin=10*log(P/0.001); %[dBm]
eta=4.9034e-8;  %[1/m]

alpha=0.2*10^-3; %[dB/m]
a=log(10^(alpha/10)); %conversion to linear units [1/m]

Prs=Pin+10*log10(eta/(2*a));

%Exercise 2

l=[1 10 20 30 40 50 60 70 80 90 100]*10^3;
Prsmeasured=[-43.2934165736081 -34.942395546942 -33.4870238634655 -33.0206642386611 -32.8481589107384 -32.7813433528162 -32.7550293461033 -32.7445986705625 -32.7404696657423 -32.7388204437105 -32.738164095946];

figure;
plot(l,Prsmeasured,'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','r','MarkerSize',10);
xlabel('Length [m]'); ylabel('Rayleigh backscattered power [dBm]'); grid on;

%Exercise 4

rsl=[-80 -78 -76 -74 -72 -70 -68 -66 -64 -62 -60 -58 -56 -54 -52]; %[dB]
ber=[4.79009400545419e-44 4.98140095347983e-44 5.49537705540659e-44 7.02505221743574e-44 1.29307374134806e-43 5.74607118138846e-43 1.9176897967779e-41 3.70709736111346e-38 3.58989217540599e-32 8.03873781355612e-24 2.28350614676051e-15 5.45332367100898e-09 4.10137502277715e-05 0.00476611129510723 0.0525645542885424]; %Rayleigh scattering coefficient

figure;
plot(rsl,log10(ber),'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','r','MarkerSize',10);
xlabel('Rayleigh scattering coefficient [dB]'); ylabel('BER'); grid on;

%Exercise 7

K=1;
Aeff=80*10^-12; %for SSMF
L=15e+3; %length in meters
alpha=0.2*10^-3; %dB/m
a=log(10^(alpha/10));
Leff=(1-exp(-a*L))/a;   %effective length
gb=2*10^-11;    %m/W
Dfb=35*10^6;    %Hz
Dfp=0;

Pth=21*K*Aeff/(gb*Leff)*(Dfb+Dfp)/Dfb;
PthdB=10*log10(Pth/0.001);

dBm=[-20 -18.2390874094432 -16.9897000433602 -16.0205999132796 -15.2287874528034 -14.5593195564972 -13.9794000867204 -13.4678748622466 -13.0102999566398 -12.5963731050576 -12.2184874961636 -11.8708664335714 -11.5490195998574 -10.9691001300806 -10.4575749056067 -10 -6.98970004336019 -5.22878745280337 -3.97940008672037 -3.01029995663981 -2.21848749616357 -1.54901959985743 -0.969100130080562 -0.457574905606752 0 3.01029995663981 4.77121254719663 6.02059991327963 6.98970004336019 7.78151250383644 8.45098040014257 9.03089986991944 9.54242509439325 10 13.0102999566398 14.7712125471966 16.0205999132796 16.9897000433602 17.7815125038364 18.4509804001426 19.0308998699194 19.5424250943932 20];
txpower=[-23.000201910359 -21.2392908952211 -19.9899051188349 -19.0208065925153 -18.2289957500142 -17.5595294860491 -16.9796116631324 -16.4680881001933 -16.0105148709529 -15.5965897107276 -15.218705808342 -14.8710864675725 -14.54924137116 -13.9693254230916 -13.4578037842676 -13.0002325296418 -9.98997300672713 -8.22907674788898 -6.97972849620144 -6.01059626933652 -5.21884439963545 -4.54948311789562 -3.96969741929695 -3.45833363182234 -3.00096907703518 -0.000596101787309067 1.64871882187657 2.41449337650153 2.70480612437097 2.8423981981083 2.92183113929459 2.97355389766327 3.00992872657639 3.03691961844142 3.13964729732248 3.16837031165037 3.18186491651372 3.1899633581296 3.19510224930285 3.19873370400169 3.20141948667256 3.20347601752218 3.20512412882267];
stokespow=[-64.5975908053632 -62.806410271903 -61.5266674140558 -60.5271268563205 -59.7047889509622 -59.0047105130165 -58.3940953271264 -57.8517891361714 -57.3633479396507 -56.9184694004936 -56.5095466369797 -56.130802884189 -55.7777477580218 -55.1351546391984 -54.5606126032712 -54.0396772579121 -50.3767927101334 -47.9287089451752 -45.9576454164387 -44.2332145603465 -42.6528246265176 -41.1624275154015 -39.7306013726332 -38.3378789944548 -36.9709934504076 -23.7227602191395 -11.3114970072828 -3.24174140929794 0.724032036677187 3.03558777182568 4.61758898322405 5.80777670261533 6.75718969393771 7.54503605278689 11.865830964825 14.0157208426337 15.4537380817391 16.5345611721639 17.4006727426633 18.1231094683349 18.7427834513935 19.285203099449 19.7675871561709];

figure;
plot(dBm,txpower,'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','r','MarkerSize',10); hold on;
plot(dBm,stokespow,'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','b','MarkerSize',10);
xlabel('Input power [dBm]'); ylabel('Power [dBm]'); grid on;
leg=legend('Transmitted power','Stokes power');
set(leg,'Fontsize',12);

%Exercise 8

dBm=[-20.0000000000001 -13.0102999566397 -9.99999999999992 -3.01029995663982 -7.105427357601E-15 6.98970004336012 9.99999999999993 16.9897000433601 19.9999999999999];
txpower=[-23.0000004895596 -16.010302421188 -13.0000049715481 -6.0103266357013 -3.00005861371148 3.9888804960912 6.98708504520334 11.6111842735595 12.2374479544111];
stokespow=[-64.6502788644624 -57.6222541446562 -54.5637043953493 -47.1738236840776 -43.6257920155763 -30.5300131059308 -15.9111343478906 12.9980569060842 18.0638394336917];

figure;
plot(dBm,txpower,'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','r','MarkerSize',10); hold on;
plot(dBm,stokespow,'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','b','MarkerSize',10);
xlabel('Input power [dBm]'); ylabel('Power [dBm]'); grid on;
leg=legend('Transmitted power','Stokes power');
set(leg,'Fontsize',12);

%Exercise 9

phase=[-180 -160 -140 -120 -100 -80 -60 -40 -20 0 20 40 60 80 100 120 140 160 180];
txpower=[6.98708504520336 6.98828012773372 6.97104500303381 6.87177105209286 6.8322744268961 6.87461870373404 6.16115769443386 4.90384152630515 3.62431564299602 3.03693075208897 3.62431564299602 4.90384152630514 6.16115769443386 6.87461870373402 6.8322744268961 6.87177105209286 6.97104500303379 6.98828012773372 6.98708504520334];
stokespow=[-15.9111343478906 -16.3656983933997 -12.3849894931588 -5.85208714309809 -4.6886001302144 -5.96974435322705 2.11674974181012 5.56648913263857 7.09236556364244 7.54503605278689 7.09236556364244 5.56648913263857 2.11674974181012 -5.96974435322705 -4.68860013021439 -5.85208714309809 -12.3849894931588 -16.3656983933997 -15.9111343478906];

figure;
plot(phase,txpower,'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','r','MarkerSize',10); hold on;
plot(phase,stokespow,'--s','Linewidth',2,'MarkerEdgeColor','k','MarkerFaceColor','b','MarkerSize',10);
xlabel('\Phi [degrees]'); ylabel('Power [dBm]'); grid on;
leg=legend('Transmitted power','Stokes power');
set(leg,'Fontsize',12);
